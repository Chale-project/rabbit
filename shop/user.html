<!doctype html>
<html lang="en">

	<head>
		<meta charset="UTF-8" />
		<title>我的</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link rel="stylesheet" type="text/css" href="../assets/css/mui.min.css" />
		<link rel="stylesheet" type="text/css" href="../assets/css/icon-extra.css" />
		<link rel="stylesheet" type="text/css" href="../assets/css/sp.style.css" />

	</head>

	<body class="user-index">

		<nav class="mui-bar mui-bar-tab">
			<a class="mui-tab-item" href="index.html">
				<span class="mui-icon icon-home"></span>
				<span class="mui-tab-label">首页</span>
			</a>
			<a class="mui-tab-item" href="product.html">
				<span class="mui-icon icon-product"></span>
				<span class="mui-tab-label">精品商城</span>
			</a>
			<a class="mui-tab-item" href="cart.html">
				<span class="mui-icon icon-cart"><span class="mui-badge wares-num">0</span></span>
				<span class="mui-tab-label">购物车</span>
			</a>
			<a class="mui-tab-item mui-active" href="user.html">
				<span class="mui-icon icon-user"></span>
				<span class="mui-tab-label">我的</span>
			</a>
		</nav>

		<div class="mui-content mui-scroll-wrapper">
			<div class="mui-scroll">
				<div class="user-service">
					<div class="card user-info">
						<div class="card-body">
							<ul class="mui-table-view user-info-profile">
								<li class="mui-table-view-cell mui-media">
									<a href="javascript:;" class="mui-navigate-right">
										<div class="avatar user-avatar mui-media-object mui-pull-left">
											<img src="../assets/images/avatar.png">
										</div>
										<div class="mui-media-body">
											<h2 class="user-name">谱奇用户</h2>
											<p class="user-account">账号：<span></span></p>
										</div>
									</a>
								</li>
							</ul>

							<div class="mui-row user-bean-coupon-share">
								<div class="mui-col-xs-4">
									<div class="user-info-bean">
										<span class="user-bean-val">0</span>
										<p>购物豆 </p>
									</div>
								</div>
								<div class="mui-col-xs-4">
									<div class="user-info-coupon">
										<span class="user-coupon-val">0</span>
										<p>优惠券</p>
									</div>
								</div>
								<div class="mui-col-xs-4">
									<div class="user-info-share">
										<span class="user-share-val">0</span>
										<p>分享佣金</p>
									</div>
								</div>
							</div>

						</div>
					</div>
					<div class="card order-item">
						<div class="card-header">
							<a href="orderIndex.html?status=0" class="mui-pull-right link-order-all">查看全部订单<span class="mui-icon mui-icon-arrowright"></span></a>
							我的订单
						</div>
						<div class="card-body">
							<ul class="mui-table-view mui-grid-view mui-grid-9">
								<li class="mui-table-view-cell mui-media mui-col-xs-3">
									<a href="orderIndex.html?status=1">
										<span class="mui-icon icon-order-status-1"><span class="mui-badge mui-badge-red order-status-type1">0</span></span>
										<div class="mui-media-body">待付款</div>
									</a>
								</li>
								<li class="mui-table-view-cell mui-media mui-col-xs-3">
									<a href="orderIndex.html?status=2">
										<span class="mui-icon icon-order-status-2"><span class="mui-badge mui-badge-red order-status-type2">0</span></span>
										<div class="mui-media-body">待发货</div>
									</a>
								</li>
								<li class="mui-table-view-cell mui-media mui-col-xs-3">
									<a href="orderIndex.html?status=3">
										<span class="mui-icon icon-order-status-3"><span class="mui-badge mui-badge-red order-status-type3">0</span></span>
										<div class="mui-media-body">待收货</div>
									</a>
								</li>
								<li class="mui-table-view-cell mui-media mui-col-xs-3">
									<a href="orderIndex.html?status=4">
										<span class="mui-icon icon-order-status-4"><span class="mui-badge mui-badge-red order-status-type4">0</span></span>
										<div class="mui-media-body">已完成</div>
									</a>
								</li>
							</ul>
						</div>
					</div>
					<div class="card order-item">
						<div class="card-header">美妆部</div>
						<div class="card-body">
							<ul class="mui-table-view mui-grid-view mui-grid-9">
								<li class="mui-table-view-cell mui-media mui-col-xs-3">
									<a class="my-stroe-system" href="javascript:;">
										<span class="mui-icon icon-store-manage"></span>
										<div class="mui-media-body">美妆部管理</div>
									</a>
								</li>
								<li class="mui-table-view-cell mui-media mui-col-xs-3">
									<a href="balanceRecord.html">
										<span class="mui-icon icon-balance-record"></span>
										<div class="mui-media-body">消费记录</div>
									</a>
								</li>
								<li class="mui-table-view-cell mui-media mui-col-xs-3">
									<a href="javascript:;" class="hzb-charge" data-url="charge.html">
										<span class="mui-icon icon-hzb-charge"></span>
										<div class="mui-media-body">美妆部充值</div>
									</a>
								</li>
								<li class="mui-table-view-cell mui-media mui-col-xs-3">
									<a id="scanQRCode" href="javascript:;">
										<span class="mui-icon icon-scanQRCode"></span>
										<div class="mui-media-body">扫一扫</div>
									</a>
								</li>
							</ul>
						</div>
					</div>
					<div class="card order-item">
						<div class="card-header">更多服务</div>
						<div class="card-body">
							<ul class="mui-table-view mui-grid-view mui-grid-9">
								<li class="mui-table-view-cell mui-media mui-col-xs-3">
									<a href="beanRecord.html">
										<span class="mui-icon icon-bean-record"></span>
										<div class="mui-media-body">用豆记录</div>
									</a>
								</li>
								<li class="mui-table-view-cell mui-media mui-col-xs-3">
									<a href="set.html">
										<span class="mui-icon icon-set"></span>
										<div class="mui-media-body">账号设置</div>
									</a>
								</li>
								<li class="mui-table-view-cell mui-media mui-col-xs-3">
									<a href="tel:13638623422">
										<span class="mui-icon icon-service"></span>
										<div class="mui-media-body">客服</div>
									</a>
								</li>
								<li class="mui-table-view-cell mui-media mui-col-xs-3">
									<a href="feedback.html">
										<span class="mui-icon icon-feedback"></span>
										<div class="mui-media-body">我要吐槽</div>
									</a>
								</li>
							</ul>
						</div>
					</div>
				</div>
				<div class="user-recom">
					<div class="user-recom-header">
						<h2>为您推荐</h2>
						<div class="user-recom-type">
							<ul id="userRecomType" class="mui-list-unstyled">

							</ul>
						</div>
					</div>

					<div class="user-recom-content home-product-recom">
						<ul id="userRecomProduct" class="mui-table-view mui-grid-view mui-list-unstyled">

						</ul>
					</div>
				</div>

			</div>
		</div>

		<script src="../assets/js/jquery-1.9.1.min.js"></script>
		<script src="../assets/js/mui.min.js"></script>
		<script src="../assets/js/jweixin-1.2.0.js"></script>
		<script src="../assets/js/base.js"></script>
		<script src="../assets/js/common.js"></script>
		<script src="../assets/js/layer.js"></script>
		<script src="../assets/js/style.js"></script>
		<script type="text/javascript">
			document.write('<script src="' + apiService + 'regs/getJsSdk.html?"><\/script>');
		</script>
		<script type="text/javascript">
			var User = {
				defaultThumb: '../assets/images/logo.png',
				x_oss_process: '?x-oss-process=style/product_192_192',
				userRole: null,
				data: {
					category_id: null,
					page: 1,
					limits: 10
				},
				init: function() {
					var scroll = mui('.mui-scroll-wrapper').scroll();
					User.getUserCardInfo();
					User.getOrderInfo();
					User.setUserRole();
					User.getGoodsType();
					WCY.updateCart();

					$("#scanQRCode").on("tap", function() {
						User.scanQRCode()
					});

					$(".user-info-profile").on("tap", function() {
						common.urlOpen('profile.html?')
					});

					$('.user-info-bean').on('tap', function() {
						common.urlOpen('donation.html?')
					});

					//优惠券中心
					$(".user-info-coupon").on("tap", function() {
						common.urlOpen('couponCenter.html?')
					});

					//分享分佣
					$(".user-info-share").on("tap", function() {
						common.urlOpen('share.html?')
					});

					$('.user-index').on('tap', '.my-stroe-system', function() {
						console.log(User.userRole)
						if(User.userRole == 0)
							common.layerMsg('加入线下商家联盟才可以访问哦^_^')
						else if(User.userRole == 1)
							common.urlOpen('../hzb/storeManageCenter.html?')
						else if(User.userRole == 2)
							common.urlOpen('../hzb/collectMoney.html?')
						else if(User.userRole == 3)
							common.urlOpen('../hzb/achievementManage.html?')
					});

					//化妆吧充值暂停
					$(".hzb-charge").on("tap", function() {
						common.layerMsg('该功能暂停使用！')
					});


					$('body').on('scroll', '.mui-scroll-wrapper', function(e) {
						var _y = -scroll.y;
						if(_y > 630) {
							$('.user-recom-type').css({
								'position': 'fixed',
								'top': _y,
								'left': 0,
								'right': 0,
								'z-index': '100'
							})
						} else {
							$('.user-recom-type').css({
								'position': 'relative',
								'top': 0,
								'left': 0,
								'right': 0,
								'z-index': '100'
							})
						}
					});

					$('.user-recom').on('tap', '.user-recom-type-item', function() {
						var _this = $(this),
							type = _this.data('typeid');
						_this.addClass('mui-active').siblings().removeClass('mui-active');
						User.data.category_id = type;
						$('#userRecomProduct').html('');
						User.getGoodsList();
					});

					$('.user-recom').on('tap', '#userRecomProduct li', function() {
						var proid = $(this).data('proid');
						WCY.goProductDetail(proid);
					});

				},

				scanQRCode: function() {
					wx.scanQRCode({
						needResult: 0,
						desc: '扫码支付',
						success: function(res) {
							console.log(res)
						}
					});
				},

				//获取用户信息
				getUserCardInfo: function() {
					common.ajaxRequest({
						u: 'card/getUserCardInfo.html?'
					}, function(res) {
						var _memberInfo = res.memberInfo,
							_cardInfo = res.cardInfo,
							_userInfo = res.userInfo;
						//User.showMemberInfo(_memberInfo);
						User.showCardInfo(_cardInfo);
						User.showUserInfo(_userInfo);
					});
				},

				showUserInfo: function(obj) {
					$('.user-avatar img').attr('src', obj.headimgurl);
					$('.user-name').text(obj.username);
					$('.user-account span').text(common.mobileToStar(obj.mobile));
				},
				showCardInfo: function(obj) {
					$('.user-bean-val').text(obj.integral);
					$('.user-coupon-val').text(obj.coupon_amount + ' 张');
					$('.user-share-val').text(obj.withdraw_card);
				},

				getOrderInfo: function() {
					common.ajaxRequest({
						u: 'order/get_order_data.html?'
					}, function(res) {
						User.showOrderInfo(res);
					});
				},
				showOrderInfo: function(obj) {
					for(i in obj) {
						var num = obj[i]
						if(i != 'type4' && num > 0) $('.order-status-' + i).css('display', 'inline-block').text(num)
					}
				},
				setUserRole: function(c) {
					common.ajaxRequest({
						u: 'Makeup_Stores/makeupUserRole.html?'
					}, function(res) {
						var _userRole = res.userRole;
						User.userRole = _userRole.role;
						common.setStorage('userRole', JSON.stringify(_userRole));
						(typeof c == 'function') && c(_userRole);
					})
				},

				getGoodsType: function() {
					common.ajaxRequest({
						u: 'category/getLeafCategory.html?'
					}, function(res) {
						User.showGoodsType(res);
					});
				},

				showGoodsType: function(obj) {
					if(obj.categoryList.length > 0) {
						var html = [],
							typeList = obj.categoryList;
						for(var i = 0; i < typeList.length; i++) {
							User.data.category_id = typeList[0].id;
							html.push('<li data-typeid="' + typeList[i].id + '" class="user-recom-type-item ' + (i == 0 ? 'mui-active' : '') + '">');
							html.push('		<a href="javascript:;">' + typeList[i].name + '</a>');
							html.push('</li>');
						}
						$('#userRecomType').html(html.join(''));
						User.getGoodsList();
					}
				},

				getGoodsList: function() {
					var data = User.data;
					console.log(data)
					common.ajaxRequest({
						u: 'goods/goods_list.html?',
						d: data
					}, function(res) {
						var list = res.goodslist;
						User.showGoodsList(list);
					});
				},

				showGoodsList: function(_list) {
					var html = [];
					if(_list.length > 0) {
						for(i in _list) {
							html.push('<li class="mui-table-view-cell mui-media mui-col-xs-6 ' + (i % 2 == 0 ? 'odd' : 'even') + '" data-proid="' + _list[i].goods_id + '">');
							html.push('	<div class="home-product-thumb">');
							html.push('		<img class="mui-media-object" src="' + (_list[i].thumbnail != null ? filesService + _list[i].thumbnail + User.x_oss_process : User.defaultThumb) + '">');
							html.push('	</div>');
							html.push('	<div class="home-product-title">');
							html.push('		<p class="mui-ellipsis-2">' + _list[i].name + '</p>');
							html.push('	</div>');
							html.push('	<div class="home-product-others">');
							html.push('		<div class="home-product-price">');
							html.push('			<span class="selling-price mui-ellipsis">￥<em>' + _list[i].price + '</em></span>');
							html.push('			<span class="original-price mui-ellipsis">￥<em>' + _list[i].wasprice + '</em></span>');
							html.push('		</div>');
							html.push('		<div class="product-list-buy"><span>购买</span></div>');
							html.push('	</div>');
							html.push('</li>');
						}
					} else {
						html.push('<li class="no-data">没有此栏目的商品^_^</li>');
					}
					$('#userRecomProduct').html(html.join(''))
				},
			};

			$(function() {
				User.init();
			});
		</script>
	</body>

</html>